---
title: "Clean Multiple Regression Code"
author: "Hayden Vega and An Bui"
date: "2025-05-12"
output:
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true
description: This file contains code for Mixed effect models and corresponding visualizations for all traits and treatments of the Functional trait project. This is the most recent version as of 2025-05-12
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

# 1. Set up

```{r}
#.........................Load Libraries.........................
library(janitor)
library(tidyverse)
library(ggeffects)
library(sjlabelled)
library(lme4)
library(DHARMa)
library(parameters)
library(effects)
library(MuMIn)
library(waffle)
library(showtext)
library(lmerTest)
library(here)

#.........................Load Fonts.........................
font_add_google(name = "Marcellus", family = "marc")
font_add_google(name = "Josefin Sans", family = "josefin")
font_add_google(name = "Lexend", family = "lex")

#...............Assigning a Standard ggplot Theme............

# ggplot theme
theme_set(theme_bw() +
            theme(panel.grid = element_blank(), 
                  plot.background = element_blank()))

# abline color
ref_line_col <- "grey"

# model prediction color
model_col <- "darkblue"

#.......Reading in Data for all Seven Traits and Treatments.........
 
# Each data frame is read in, then specimen_id column is separated to create new 
# columns, then we create an individual ID column from date, site, and individual.

# using read_csv and `here` package to get rid of file paths
height_all <- read_csv(here("data", "preliminary_data", "final_height.csv")) |> 
  # separate specimen_id column by - to create new date, site, individual, and specimen columns
  separate_wider_delim(specimen_id, 
                       delim = "-", 
                       names = c("date", "site", "individual", "specimen"), 
                       cols_remove = FALSE) |> 
  # create an individual id column
  unite("individual_id", date:individual, remove = TRUE, sep = "-") 


width_all <- read_csv(here("data", "preliminary_data", "final_width.csv")) |> 
  separate_wider_delim(specimen_id,
                       delim = "-",
                       names = c("date", "site", "individual", "specimen"),
                       cols_remove = FALSE) |> 
  unite("individual_id", date:individual, remove = TRUE, sep = "-")

perimeter_all <- read_csv(here("data", "preliminary_data", "final_perimeter.csv")) |> 
  separate_wider_delim(specimen_id, 
                       delim = "-", 
                       names = c("date", "site", "individual", "specimen"),
                       cols_remove = FALSE) |> 
  unite("individual_id", date:individual, remove = TRUE, sep = "-")

surf_all <- read_csv(here("data", "preliminary_data", "final_surf.csv")) |> 
  separate_wider_delim(specimen_id, 
                       delim = "-", 
                       names = c("date", "site", "individual", "specimen"), 
                       cols_remove = FALSE) |> 
  unite("individual_id", date:individual, remove = TRUE, sep = "-")

tdmc_all <- read_csv(here("data", "preliminary_data", "final_tdmc.csv")) |> 
  separate_wider_delim(specimen_id, 
                       delim = "-", 
                       names = c("date", "site", "individual", "specimen"), 
                       cols_remove = FALSE) |> 
  unite("individual_id", date:individual, remove = TRUE, sep = "-")

thickness_all <- read_csv(here("data", "preliminary_data", "final_thickness.csv")) |> 
  separate_wider_delim(specimen_id, 
                       delim = "-", 
                       names = c("date", "site", "individual", "specimen"),
                       cols_remove = FALSE) |> 
  unite("individual_id", date:individual, remove = TRUE, sep = "-")

volume_all <- read_csv(here("data", "preliminary_data", "final_volume.csv")) |>
  separate_wider_delim(specimen_id, 
                       delim = "-", 
                       names = c("date", "site", "individual", "specimen"), 
                       cols_remove = FALSE) |> 
  unite("individual_id", date:individual, remove = TRUE, sep = "-")

```

# 2. Linear mixed effect models

## a. initial values predicted by rehydrate values and/or species

This section includes code to fit linear mixed effect models to answer the question: how well do rehydrated trait values predict initial trait values? Each trait is predicted by two models: initial values as a function of rehydrated values **with** a species interaction, or intiial values as a function of rehydrated values **without** a species interaction - both models have individual_id included as a random effect. We view model summaries using `summary()`.

### Height
     
```{r height-models, include=FALSE}

height_reg_ir <- lmer(height_i ~ height_r * species + (1 | individual_id), data = height_all)
summary(height_reg_ir)
#Model with species interaction

height_reg_ir_nospecies <- lmer(height_i ~ height_r + (1 | individual_id), data = height_all)
summary(height_reg_ir_nospecies)
#Model without a species interaction
```

### Width

```{r width-models}
#..........................Width Models.........................

width_reg_ir <- lmer(width_i ~ width_r * species + (1 | individual_id), data = width_all)
summary(width_reg_ir)

width_reg_ir_nospecies <- lmer(width_i ~ width_r + (1 | individual_id), data = width_all)
summary(width_reg_ir_nospecies)

```

### Perimeter

```{r perimeter-models}

perimeter_reg_ir <- lmer(per_i ~ per_r * species + (1 | individual_id), data = perimeter_all)
summary(perimeter_reg_ir)

perimeter_reg_ir_nospecies <- lmer(per_i ~ per_r + (1 | individual_id), data = perimeter_all)
summary(perimeter_reg_ir_nospecies)

```

### Surface Area

```{r surf-models}

surf_reg_ir <- lmer(surf_i ~ surf_r * species + (1 | individual_id), data = surf_all)
summary(surf_reg_ir)

surf_reg_ir_nospecies <- lmer(surf_i ~ surf_r + (1 | individual_id), data = surf_all)
summary(surf_reg_ir_nospecies)
```

### Weight

```{r tdmc-models}

tdmc_reg_ir <- lmer(weight_i ~ weight_r * species + (1 | individual_id), data = tdmc_all)
summary(tdmc_reg_ir)

tdmc_reg_ir_nospecies <- lmer(weight_i ~ weight_r + (1 | individual_id), data = tdmc_all)
summary(tdmc_reg_ir_nospecies)

```

### Thickness

```{r thick-models}

thick_reg_ir <- lmer(thick_i ~ thick_r * species + (1 | individual_id), data = thickness_all)
summary(thick_reg_ir)

thick_reg_ir_nospecies <- lmer(thick_i ~ thick_r + (1 | individual_id), data = thickness_all)
summary(thick_reg_ir_nospecies)
```

### Volume

```{r volume-models}

volume_reg_ir <- lmer(vol_i ~ vol_r * species + (1 | individual_id), data = volume_all)
summary(volume_reg_ir)

volume_reg_ir_nospecies <- lmer(vol_i ~ vol_r + (1 | individual_id), data = volume_all)
summary(volume_reg_ir_nospecies)
```

## b. Initial values predicted by herbarium values

This section includes code to fit linear mixed effect models to answer the question: how well do **herbarium** trait values predict initial trait values? Each trait is predicted by two models: initial values as a function of herbarium values **with** a species interaction and intiial values as a function of herbarium values **without** a species interaction - both models have individual_id included as a random effect. We view model summaries using `summary()`.

### Height

```{r height-herbarium-models}

height_reg_ih <- lmer(height_i ~ height_h * species + (1 | individual_id), data = height_all)
summary(height_reg_ih)
#This model describes height_i as a function of height_h, with a species interaction term and random effect of individual_id

height_reg_ih_nospecies <- lmer(height_i ~ height_h + (1 | individual_id), data = height_all)
summary(height_reg_ih_nospecies)
#This model describes height_i as a function of height_h with a random effect of individual_id and without a species interaction term
```

### Width

```{r width-herbarium-models}

width_reg_ih <- lmer(width_i ~ width_h * species + (1 | individual_id), data = width_all)
summary(width_reg_ih)

width_reg_ih_nospecies <- lmer(width_i ~ width_h + (1 | individual_id), data = width_all)
summary(width_reg_ih_nospecies)
```

### Perimeter

```{r perimeter-herbarium-models}

perimeter_reg_ih <- lmer(per_i ~ per_h * species + (1 | individual_id), data = perimeter_all)
summary(perimeter_reg_ih)

perimeter_reg_ih_nospecies <- lmer(per_i ~ per_h + (1 | individual_id), data = perimeter_all)
summary(perimeter_reg_ih_nospecies)
```

### Surface Area

```{r surf-herbarium-models}

surf_reg_ih <- lmer(surf_i ~ surf_h * species + (1 | individual_id), data = surf_all)
summary(surf_reg_ih)

surf_reg_ih_nospecies <- lmer(surf_i ~ surf_h + (1 | individual_id), data = surf_all)
summary(surf_reg_ih_nospecies)
```

### Weight

```{r tdmc-herbarium-models}

tdmc_reg_ih <- lmer(weight_i ~ weight_h * species + (1 | individual_id), data = tdmc_all)
summary(tdmc_reg_ih)

tdmc_reg_ih_nospecies <- lmer(weight_i ~ weight_h + (1 | individual_id), data = tdmc_all)
summary(tdmc_reg_ih_nospecies)
```

### Thickness

```{r thick-herbarium-models}

thick_reg_ih <- lmer(thick_i ~ thick_h * species + (1 | individual_id), data = thickness_all)
summary(thick_reg_ih)

thick_reg_ih_nospecies <- lmer(thick_i ~ thick_h + (1 | individual_id), data = thickness_all)
summary(thick_reg_ih_nospecies)
```

### Volume

```{r volume-herbarium-models}

volume_reg_ih <- lmer(vol_i ~ vol_h * species + (1 | individual_id), data = volume_all)
summary(volume_reg_ih)

volume_reg_ih_nospecies <- lmer(vol_i ~ vol_h + (1 | individual_id), data = volume_all)
summary(volume_reg_ih_nospecies)
```

# 3. Comparing models using AIC

This section includes code comparing the AIC values for models with a species interaction term and without a species interaction term to answer the question: Do models with a species interaction improve the model's fit? All trait models for rehydrated and herbarium traits are tested, and the results are commented below each model. 

## a. Comparisons for models with rehydrated traits as predictors

### Height

```{r height-AIC}
#..........................Comparisons for Height Models........................

model.sel(height_reg_ir, height_reg_ir_nospecies)
#nospecies is better
```

### Width

```{r width-AIC}
#..........................Comparisons for Width Models.........................

model.sel(width_reg_ir, width_reg_ir_nospecies)
#nospecies is better
```

### Perimeter

```{r perimeter-AIC}
#..........................Comparisons for Perimeter Models......................

model.sel(perimeter_reg_ir, perimeter_reg_ir_nospecies)
#with species is better
```

### Surface Area

```{r surf-AIC}
#..........................Comparisons for Surface Area Models..................

model.sel(surf_reg_ir, surf_reg_ir_nospecies)
#species is better
```

### Weight

```{r tdmc-AIC}
#..........................Comparisons for Weight Models........................

model.sel(tdmc_reg_ir, tdmc_reg_ir_nospecies)
#species is better
```

### Thickness

```{r thick-AIC}
#..........................Comparisons for Thickness Models.....................

model.sel(thick_reg_ir, thick_reg_ir_nospecies)
#nospecies is better, but rehydrated thickness it's not a good predictor overall
```

### Volume

```{r volume-AIC}
#..........................Comparisons for Volume Models........................

model.sel(volume_reg_ir, volume_reg_ir_nospecies)
#with species is better
```

## b. Comparisons for models with Herbarium traits as a predictor variable

### Height

```{r height-herbarium-AIC}
#..........................Comparisons for Height Models........................

model.sel(height_reg_ih, height_reg_ih_nospecies)
#nospecies is better
```

### Width

```{r width-herbarium-AIC}
#..........................Comparisons for Width Models........................

model.sel(width_reg_ih, width_reg_ih_nospecies)
#species is better
```

### Perimeter

```{r perimeter-herbarium-AIC}
#.......................Comparisons for Perimeter Models........................

model.sel(perimeter_reg_ih, perimeter_reg_ih_nospecies)
#with species is better
```

### Surface Area

```{r surf-herbarium-AIC}
#....................Comparisons for Surface Area Models........................

model.sel(surf_reg_ih, surf_reg_ih_nospecies)
#species is better
```

### Weight

```{r tdmc-herbarium-AIC}
#..........................Comparisons for Weight Models........................

model.sel(tdmc_reg_ih, tdmc_reg_ih_nospecies)
#species is better
```

### Thickness

```{r thick-herbarium-AIC}
#.......................Comparisons for Thickness Models........................

model.sel(thick_reg_ih, thick_reg_ih_nospecies)
#species is better, but doesn't really matter cause it's not a good predictor
```

### Volume

```{r volume-herbarium-AIC}
#..........................Comparisons for Volume Models........................

model.sel(volume_reg_ih, volume_reg_ih_nospecies)
#with species is better
```

# 4. Calculating R squared values for the best fitting models

This section includes code that calculates the marginal and conditional R squared values of the best fitting models from the section above. We calculate the R squared value using MuMIn::r.squaredGLMM(model_name) from the MuMIn package. 

## a. Calculating R squared values for models with rehydrated traits as a predictor

### Height

```{r r^2-height}
#..................R^2 for Height Model without species interaction term........

MuMIn::r.squaredGLMM(height_reg_ir_nospecies)

```

### Width

```{r r^2-width}
#..................R^2 for Width Model without species interaction term........

MuMIn::r.squaredGLMM(width_reg_ir_nospecies)

```

### Perimeter

```{r r2-perimeter}
#...............R^2 for Perimeter Model with species interaction term........

MuMIn::r.squaredGLMM(perimeter_reg_ir)
```

### Surface Area

```{r r2-surf}
#............R^2 for Surface Area Model with species interaction term........

MuMIn::r.squaredGLMM(surf_reg_ir)

```

### Weight

```{r r2-tdmc}
#..................R^2 for Weight Model with species interaction term........

MuMIn::r.squaredGLMM(tdmc_reg_ir)
```

### Thickness

```{r r2-thick}
#...............R^2 for Thickness Model without species interaction term........

MuMIn::r.squaredGLMM(thick_reg_ir_nospecies)
```

### Volume

```{r r2-volume}
#..................R^2 for Volume Model with species interaction term........

MuMIn::r.squaredGLMM(volume_reg_ir)
```

## b. Calculating R squared values for models with Herbarium traits as predictor variables

### Height  

```{r r^2-herbarium-height}
#..................R^2 for Height Model without species interaction term........

MuMIn::r.squaredGLMM(height_reg_ih_nospecies)
```

### Width

```{r r^2-herbarium-width}
#..................R^2 for Width Model with species interaction term............

MuMIn::r.squaredGLMM(width_reg_ih)

```

### Perimeter

```{r r2-herbarium-perimeter}
#...............R^2 for Perimeter Model with species interaction term........

MuMIn::r.squaredGLMM(perimeter_reg_ih)
```

### Surface Area

```{r r2-herbarium-surf}
#............R^2 for Surface Area Model with species interaction term........

MuMIn::r.squaredGLMM(surf_reg_ih)

```

### Weight

```{r r2-herbarium-tdmc}
#..................R^2 for Weight Model with species interaction term........

MuMIn::r.squaredGLMM(tdmc_reg_ih)
```

### Thickness

```{r r2-herbarium-thick}
#..................R^2 for Thickness Model with species interaction term........

MuMIn::r.squaredGLMM(thick_reg_ih)
```

### Volume

```{r r2-herbarium-volume}
#..................R^2 for Volume Model with species interaction term...........

MuMIn::r.squaredGLMM(volume_reg_ih)
```

# 5. Saving models as predictions for later plotting

This section includes code to save the model predictions of the best fitting models as data frames using ggpredict(). This includes predictions for all traits and both rehydrate and herbarium treatments.

## a. Saving predictions for models with rehydrated traits as predictor variables

### Height

```{r rehydrate_height_predictions}
     #........Predictions for the Height Model Without Species........

height_ir_predictions <- ggpredict(height_reg_ir_nospecies, terms = "height_r[0:45]") |> 
  #saving predictions for height_r values from 0-45 
  mutate(trait = "height") #adding a column to label the type of trait values

height_ir_predictions
```

### Width

```{r rehydrate_width_predictions}
     #........Predictions for the Width Model Without Species........

width_ir_predictions <- ggpredict(width_reg_ir_nospecies, terms = "width_r[0:30]") |> #max width = 24
  mutate(trait = "width") 

# look at the data frame
width_ir_predictions

```

### Perimeter

```{r rehydrate_perimeter_predictions}
     #........Predictions for the Height Model With Species........
perimeter_ir_predictions <- ggpredict(perimeter_reg_ir, terms = "per_r[0:375]") |> 
  mutate(trait = "perimeter")

     #...........Incorporating Species as a Prediction Term...........
perimeter_ir_predictions_species <- ggpredict(perimeter_reg_ir, terms = c("per_r", "species")) |> 
  as_tibble() |> #converting to a tibble
  rename(species = group)
# look at the data frame
perimeter_ir_predictions
```

### Surface Area

```{r rehydrate_surf_predictions}
     #........Predictions for the Height Model With Species........

surf_ir_predictions <- ggpredict(surf_reg_ir, terms = "surf_r[0:430]") |> 
  mutate(trait = "surface area")

     #...........Incorporating Species as a Prediction Term...........
surf_ir_predictions_species <- ggpredict(surf_reg_ir, terms = c("surf_r", "species")) |> 
  as_tibble() |> 
  rename(species = group)
# look at the data frame
surf_ir_predictions
```

### Weight

```{r rehydrate_tdmc_predictions, fig.width = 20, fig.height = 10}
     #........Predictions for the Weight Model With Species........

tdmc_ir_predictions <- ggpredict(tdmc_reg_ir, terms = "weight_r[0:29050]") |> 
  as_tibble() |> 
  mutate(trait = "thallus dry matter content")

     #...........Incorporating Species as a Prediction Term...........
tdmc_ir_predictions_species <- ggpredict(tdmc_reg_ir, terms = c("weight_r", "species")) |> 
  as_tibble() |> 
  rename(species = group)
# look at the data frame
tdmc_ir_predictions

```

### Thickness

```{r rehydrate_thick - prediction}
     #........Predictions for the Thickness Model Without Species........

thick_ir_predictions <- ggpredict(thick_reg_ir_nospecies, terms = "thick_r[0:2]")  |> 
  mutate(trait = "thickness")

# look at the data frame
thick_ir_predictions

```

### Volume

```{r rehydrate_volume - prediction}
     #........Predictions for the Volume Model With Species........

volume_ir_predictions <- ggpredict(volume_reg_ir, terms = "vol_r[0:30]") |> 
  mutate(trait = "volume")

     #...........Incorporating Species as a Prediction Term...........
volume_ir_predictions_species <- ggpredict(volume_reg_ir, terms = c("vol_r", "species")) |> 
  as_tibble() |> 
  rename(species = group)
# look at the data frame
volume_ir_predictions

```

## b. Saving predictions for models with herbarium traits as predictor variables
 
### Height    

```{r height-herbarium_predictions}

     #........Predictions for the Height Model Without Species........
height_ih_predictions <- ggpredict(height_reg_ih_nospecies, terms = "height_h[0:45]") 

height_ih_predictions
```

### Width

```{r width-herbarium_predictions}
    
 #........Predictions for the Width Model Without Species........
width_ih_predictions <- ggpredict(width_reg_ih_nospecies, terms = "width_h[0:30]") #max width = 24

# look at the data frame
width_ih_predictions

     #...........Incorporating Species as a Prediction Term...........
width_ih_predictions_species <- ggpredict(width_reg_ih, terms = c("width_h", "species")) |> 
  as_tibble() |> 
  rename(species = group)


```

### Perimeter

```{r perimeter-herbarium_predictions}
     
#........Predictions for the Perimeter Model With Species........
perimeter_ih_predictions <- ggpredict(perimeter_reg_ih, terms = "per_h[0:375]") 

     #...........Incorporating Species as a Prediction Term...........
perimeter_ih_predictions_species <- ggpredict(perimeter_reg_ih, terms = c("per_h", "species")) |> 
  as_tibble() |> 
  rename(species = group)
# look at the data frame
perimeter_ih_predictions_species
```

### Surface Area

```{r surf-herbarium_predictions}
   
 #........Predictions for the Surface Area Model With Species........
surf_ih_predictions <- ggpredict(surf_reg_ih, terms = "surf_h[0:430]") 

     #...........Incorporating Species as a Prediction Term...........
surf_ih_predictions_species <- ggpredict(surf_reg_ih, terms = c("surf_h", "species")) |> 
  as_tibble() |> 
  rename(species = group)
# look at the data frame
surf_ih_predictions_species
```

### Weight

```{r tdmc-herbarium_predictions}

     #........Predictions for the Weight Model With Species........

tdmc_ih_predictions <- ggpredict(tdmc_reg_ih, terms = "weight_h[0:29050]") 

     #...........Incorporating Species as a Prediction Term...........
tdmc_ih_predictions_species <- ggpredict(tdmc_reg_ih, terms = c("weight_h", "species")) |> 
  as_tibble() |> 
  rename(species = group)
# look at the data frame
tdmc_ih_predictions
tdmc_ih_predictions_species

```

### Thickness

```{r thick-herbarium - prediction}
     #........Predictions for the Thickness Model Without Species........

thick_ih_predictions <- ggpredict(thick_reg_ih_nospecies, terms = "thick_h[0:2]") 

# look at the data frame
thick_ih_predictions

     #...........Incorporating Species as a Prediction Term...........
thick_ih_predictions_species <- ggpredict(thick_reg_ih, terms = c("thick_h", "species"))  |> 
  as_tibble() |> 
  rename(species = group)

```

### Volume

```{r volume-herbarium - prediction}

     #........Predictions for the Volume Model With Species........
volume_ih_predictions <- ggpredict(volume_reg_ih, terms = "vol_h[0:30]") 

     #...........Incorporating Species as a Prediction Term...........
volume_ih_predictions_species <- ggpredict(volume_reg_ih, terms = c("vol_h", "species")) |> 
  as_tibble() |> 
  rename(species = group)
# look at the data frame
volume_ih_predictions
volume_ih_predictions_species

```
     
# 6. Visualizing Models

This section includes code for scatterplots of model predictions using ggplot. Every model has one scatterplot with initial trait values on the Y axis and treatment (rehydrated/herbarium) trait values on the X axis. Models that incorporate a species interaction have an additional scatterplot faceted by species. 

## a. Visualizing models with Rehydrated traits on the X axis

### Height

```{r rehydrate_height - PLOT}

     #.....Scatterplot of height_r(x) as Predictor of height_i(y).....

height_ir_plot <- ggplot() +
  
  # plot the raw data as points
  geom_point(data = height_all,
             aes(x = height_r,
                 y = height_i),
             alpha = 0.5,
             color = model_col,
             shape = 21) +
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence interval 
  geom_ribbon(data = height_ir_predictions,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2,
              fill = model_col) +
  
  # plot the prediction line
  geom_line(data = height_ir_predictions,
            aes(x = x,
                y = predicted),
            color = model_col,
            linewidth = 1) +
  
  # labels
  labs(x = "Rehydrate height (mm)",
       y = "Initial height (mm)") +
  
  # controlling axes to make the plot look square
  # this makes it easier to see the difference between the model and the 1:1 line
  scale_x_continuous(breaks = seq(from = 0, to = 50, by = 10), 
                     limits = c(0, 50)) +
  scale_y_continuous(breaks = seq(from = 0, to = 50, by = 10), 
                     limits = c(0, 50))+
  #add equation + r squared
   annotate("text", x = 10, y = 45, label= "y = 1.02x + 0.0407
R squared = 0.996")
  

height_ir_plot
```

### Width

```{r rehydrate_width - PLOT}

     #.....Scatterplot of width_r(x) as Predictor of width_i(y).....

width_ir_plot <- ggplot() +
  
  # plot the raw data as points
  geom_point(data = width_all,
             aes(x = width_r,
                 y = width_i),
             alpha = 0.5,
             color = model_col,
             shape = 21) +
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence interval 
  geom_ribbon(data = width_ir_predictions,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2,
              fill = model_col) +
  
  # plot the prediction line
  geom_line(data = width_ir_predictions,
            aes(x = x,
                y = predicted),
            color = model_col,
            linewidth = 1) +
  
  # labels
  labs(x = "Rehydrate Width (mm)",
       y = "Initial width (mm)") +
  
  # controlling axes to make the plot look square
  # this makes it easier to see the difference between the model and the 1:1 line
  scale_x_continuous(breaks = seq(from = 0, to = 30, by = 5), 
                     limits = c(0, 30)) +
  scale_y_continuous(breaks = seq(from = 0, to = 30, by = 5), 
                     limits = c(0, 30))+
  #add equation + r squared
   annotate("text", x = 10, y = 25, label= "y = 0.994x + 0.0865
R squared = 0.996")
  
width_ir_plot

```

### Thickness

```{r rehydrate_thick - PLOT, fig.width = 20, fig.height = 10}
     
     #.....Scatterplot of thickness_r(x) as Predictor of thickness_i(y).....

thick_ir_plot <- ggplot() +
  
  # plot the raw data as points
  geom_point(data = thickness_all,
             aes(x = thick_r,
                 y = thick_i),
             alpha = 0.5,
             color = model_col,
             shape = 21) +
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence interval 
  geom_ribbon(data = thick_ir_predictions,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2,
              fill = model_col) +
  
  # plot the prediction line
  geom_line(data = thick_ir_predictions,
            aes(x = x,
                y = predicted),
            color = model_col,
            linewidth = 1) +
  
  # labels
  labs(x = "Rehydrate thickness (mm)",
       y = "Initial thickness (mm)") +
  
  # controlling axes to make the plot look square
  # this makes it easier to see the difference between the model and the 1:1 line
  scale_x_continuous(breaks = seq(from = 0, to = 2, by = 0.25), 
                     limits = c(0, 2)) +
  scale_y_continuous(breaks = seq(from = 0, to = 2, by = 0.25), 
                     limits = c(0, 2))+
  #add equation + r squared
   annotate("text", x = 0.75, y = 1.75, label= "y = 0.922x + 0.134
R squared = 0.882")

thick_ir_plot
```

### Perimeter

```{r rehydrate_perimeter - PLOT}
     #.....Scatterplot of perimeter_r(x) as Predictor of perimeter_i(y).....
perimeter_ir_plot <- ggplot() +
  
  # plot the raw data as points
  geom_point(data = perimeter_all,
             aes(x = per_r,
                 y = per_i),
             alpha = 0.5,
             color = model_col,
             shape = 21) +
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence interval 
  geom_ribbon(data = perimeter_ir_predictions,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2,
              fill = model_col) +
  
  # plot the prediction line
  geom_line(data = perimeter_ir_predictions,
            aes(x = x,
                y = predicted),
            color = model_col,
            linewidth = 1) +
  
  # labels
  labs(x = "Rehydrate perimeter (mm)",
       y = "Initial perimeter (mm)") +
  
  # controlling axes to make the plot look square
  # this makes it easier to see the difference between the model and the 1:1 line
  scale_x_continuous(breaks = seq(from = 0, to = 375, by = 50), 
                     limits = c(0, 375)) +
  scale_y_continuous(breaks = seq(from = 0, to = 375, by = 50), 
                     limits = c(0, 375))+
  #add equation + r squared
   annotate("text", x = 75, y = 300, label= "y = 1.02x + 0.0407
R squared = 0.996")
perimeter_ir_plot

  #.Scatterplot of height_r(x) as Predictor of height_i(y) with a species facet.

perimeter_ir_plot_species <- ggplot() +
  
  geom_point(data = perimeter_all,
             aes(x = per_r,
                 y = per_i,
                 color = species),
             alpha = 0.5,
             shape = 21) + 
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence intervals
  geom_ribbon(data = perimeter_ir_predictions_species,
            aes(x = x,
                y = predicted,
                ymin = conf.low,
                ymax = conf.high,
                fill = species,
                group = species),
            alpha = 0.2) +
  
  # plot the model predictions
  geom_line(data = perimeter_ir_predictions_species,
            aes(x = x,
                y = predicted,
                color = species,
                group = species)) +
  
  # labels
  labs(x = "Rehydrate perimeter (mm)",
       y = "Initial perimeter (mm)") +
  
  # theme
  theme(legend.position = "none",
        strip.background = element_blank(),
        strip.text = element_text(size = 12)) +
  
  # facet
  facet_wrap(~ species, nrow = 2,
             scales = "free")


  perimeter_ir_plot_species
```

### Surface Area

```{r rehydrate_surf - PLOT (species)}

     #.....Scatterplot of surf_r(x) as Predictor of surf_i(y).....

surf_ir_plot <- ggplot() +
  
  # plot the raw data as points
  geom_point(data = surf_all,
             aes(x = surf_r,
                 y = surf_i),
             alpha = 0.5,
             color = model_col,
             shape = 21) +
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence interval 
  geom_ribbon(data = surf_ir_predictions,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2,
              fill = model_col) +
  
  # plot the prediction line
  geom_line(data = surf_ir_predictions,
            aes(x = x,
                y = predicted),
            color = model_col,
            linewidth = 1) +
  
  # labels
  labs(x = "Rehydrate Surface Area (mm^2)",
       y = "Initial Surface Area (mm^2)") +
  
  # controlling axes to make the plot look square
  # this makes it easier to see the difference between the model and the 1:1 line
  scale_x_continuous(breaks = seq(from = 0, to = 450, by = 75), 
                     limits = c(0, 450)) +
  scale_y_continuous(breaks = seq(from = 0, to = 450, by = 75), 
                     limits = c(0, 450))
surf_ir_plot

 #.Scatterplot of surf_r(x) as Predictor of surf_i(y) with a species facet.
surf_ir_plot_species <- ggplot() +
  
  geom_point(data = surf_all,
             aes(x = surf_r,
                 y = surf_i,
                 color = species),
             alpha = 0.5,
             shape = 21) + 
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence intervals
  geom_ribbon(data = surf_ir_predictions_species,
            aes(x = x,
                y = predicted,
                ymin = conf.low,
                ymax = conf.high,
                fill = species,
                group = species),
            alpha = 0.2) +
  
  # plot the model predictions
  geom_line(data = surf_ir_predictions_species,
            aes(x = x,
                y = predicted,
                color = species,
                group = species)) +
  
  # labels
  labs(x = "Rehydrate surface area (mm^2)",
       y = "Initial surface area (mm^2)") +
  
  # theme
  theme(legend.position = "none",
        strip.background = element_blank(),
        strip.text = element_text(size = 12)) +
  
  # facet
  facet_wrap(~ species, nrow = 2,
             scales = "free")


  surf_ir_plot_species
```

### Weight

```{r rehydrate_tdmc - plot - species}
    
 #.....Scatterplot of weight_r(x) as Predictor of weight_i(y).....

tdmc_ir_plot <- ggplot() +
  
  # plot the raw data as points
  geom_point(data = tdmc_all,
             aes(x = weight_r,
                 y = weight_i),
             alpha = 0.5,
             color = model_col,
             shape = 21) +
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence interval 
  geom_ribbon(data = tdmc_ir_predictions,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2,
              fill = model_col) +
  
  # plot the prediction line
  geom_line(data = tdmc_ir_predictions,
            aes(x = x,
                y = predicted),
            color = model_col,
            linewidth = 1) +
  
  # labels
  labs(x = "Rehydrate weight (g)",
       y = "Initial weight (g)") +
  
  # controlling axes to make the plot look square
  # this makes it easier to see the difference between the model and the 1:1 line
  scale_x_continuous(breaks = seq(from = 0, to = 4850, by = 810), 
                     limits = c(0, 4850)) +
  scale_y_continuous(breaks = seq(from = 0, to = 4850, by = 810), 
                     limits = c(0, 4850))
tdmc_ir_plot

  #.Scatterplot of weight_r(x) as Predictor of weight_i(y) with a species facet.


tdmc_ir_plot_species <- ggplot() +
  
  geom_point(data = tdmc_all,
             aes(x = weight_r,
                 y = weight_i,
                 color = species),
             alpha = 0.5,
             shape = 21) + 
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence intervals
  geom_ribbon(data = tdmc_ir_predictions_species,
            aes(x = x,
                y = predicted,
                ymin = conf.low,
                ymax = conf.high,
                fill = species,
                group = species),
            alpha = 0.2) +
  
  # plot the model predictions
  geom_line(data = tdmc_ir_predictions_species,
            aes(x = x,
                y = predicted,
                color = species,
                group = species)) +
  
  # labels
  labs(x = "Rehydrate weight (g)",
       y = "Initial weight (g)") +
  
  # theme
  theme(legend.position = "none",
        strip.background = element_blank(),
        strip.text = element_text(size = 12)) +
  
  # facet
  facet_wrap(~ species, nrow = 2,
             scales = "free")


 tdmc_ir_plot_species
```

### Volume

```{r rehydrate-volume - PLOT}
     
#.....Scatterplot of vol_r(x) as Predictor of vol_i(y).....

volume_ir_plot <- ggplot() +
  
  # plot the raw data as points
  geom_point(data = volume_all,
             aes(x = vol_r,
                 y = vol_i),
             alpha = 0.5,
             color = model_col,
             shape = 21) +
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence interval 
  geom_ribbon(data = volume_ir_predictions,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2,
              fill = model_col) +
  
  # plot the prediction line
  geom_line(data = volume_ir_predictions,
            aes(x = x,
                y = predicted),
            color = model_col,
            linewidth = 1) +
  
  # labels
  labs(x = "Rehydrate volume (mL)",
       y = "Initial volume (mL)") +
  
  # controlling axes to make the plot look square
  # this makes it easier to see the difference between the model and the 1:1 line
  scale_x_continuous(breaks = seq(from = 0, to = 15, by = 2.5), 
                     limits = c(0, 15)) +
  scale_y_continuous(breaks = seq(from = 0, to = 15, by = 2.5), 
                     limits = c(0, 15))
volume_ir_plot

  #.Scatterplot of volume_r(x) as Predictor of volume_i(y) with a species facet.


volume_ir_plot_species <- ggplot() +
  
  geom_point(data = volume_all,
             aes(x = vol_r,
                 y = vol_i,
                 color = species),
             alpha = 0.5,
             shape = 21) + 
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence intervals
  geom_ribbon(data = volume_ir_predictions_species,
            aes(x = x,
                y = predicted,
                ymin = conf.low,
                ymax = conf.high,
                fill = species,
                group = species),
            alpha = 0.2) +
  
  # plot the model predictions
  geom_line(data = volume_ir_predictions_species,
            aes(x = x,
                y = predicted,
                color = species,
                group = species)) +
  
  # labels
  labs(x = "Rehydrate volume (mL)",
       y = "Initial volume (mL)") +
  
  # theme
  theme(legend.position = "none",
        strip.background = element_blank(),
        strip.text = element_text(size = 12)) +
  
  # facet
  facet_wrap(~ species, nrow = 2,
             scales = "free")


  volume_ir_plot_species

```

## b. Visualizing models with herbarium traits on the X axis

### Height 

```{r height-herbarium - PLOT}

     #....Scatterplot of height_h(x) as a Predictor of height_i(y)....
height_ih_plot <- ggplot() +
  
  # plot the raw data as points
  geom_point(data = height_all,
             aes(x = height_h,
                 y = height_i),
             alpha = 0.5,
             color = model_col,
             shape = 21) +
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence interval 
  geom_ribbon(data = height_ih_predictions,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2,
              fill = model_col) +
  
  # plot the prediction line
  geom_line(data = height_ih_predictions,
            aes(x = x,
                y = predicted),
            color = model_col,
            linewidth = 1) +
  
  # labels
  labs(x = "Herbarium height (mm)",
       y = "Initial height (mm)") +
  
  # controlling axes to make the plot look square
  # this makes it easier to see the difference between the model and the 1:1 line
  scale_x_continuous(breaks = seq(from = 0, to = 50, by = 10), 
                     limits = c(0, 50)) +
  scale_y_continuous(breaks = seq(from = 0, to = 50, by = 10), 
                     limits = c(0, 50))+
  #add equation + r squared
   annotate("text", x = 10, y = 45, label= "y = 1.14x + 0.258
R squared = 0.929")

height_ih_plot
```

### Width

```{r width-herbarium - PLOT}
    
 #....Scatterplot of width_h(x) as a Predictor of width_i(y)....
width_ih_plot <- ggplot() +
  
  # plot the raw data as points
  geom_point(data = width_all,
             aes(x = width_h,
                 y = width_i),
             alpha = 0.5,
             color = model_col,
             shape = 21) +
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence interval 
  geom_ribbon(data = width_ih_predictions,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2,
              fill = model_col) +
  
  # plot the prediction line
  geom_line(data = width_ih_predictions,
            aes(x = x,
                y = predicted),
            color = model_col,
            linewidth = 1) +
  
  # labels
  labs(x = "Herbarium width (mm)",
       y = "Initial width (mm)") +
  
  # controlling axes to make the plot look square
  # this makes it easier to see the difference between the model and the 1:1 line
  scale_x_continuous(breaks = seq(from = 0, to = 20, by = 5), 
                     limits = c(0, 20)) +
  scale_y_continuous(breaks = seq(from = 0, to = 20, by = 5), 
                     limits = c(0, 20))
width_ih_plot

  #.Scatterplot of width_h(x) as Predictor of width_i(y) with a species facet.
width_ih_plot_species <- ggplot() +
  
  geom_point(data = width_all,
             aes(x = width_h,
                 y = width_i,
                 color = species),
             alpha = 0.5,
             shape = 21) + 
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence intervals
  geom_ribbon(data = width_ih_predictions_species,
            aes(x = x,
                y = predicted,
                ymin = conf.low,
                ymax = conf.high,
                fill = species,
                group = species),
            alpha = 0.2) +
  
  # plot the model predictions
  geom_line(data = width_ih_predictions_species,
            aes(x = x,
                y = predicted,
                color = species,
                group = species)) +
  
  # labels
  labs(x = "Herbarium width (mm)",
       y = "Initial width (mm)") +
  
  # theme
  theme(legend.position = "none",
        strip.background = element_blank(),
        strip.text = element_text(size = 12)) +
  
  # facet
  facet_wrap(~ species, nrow = 2,
             scales = "free")


  width_ih_plot_species

```

### Thickness

```{r thick-herbarium - PLOT}

     #....Scatterplot of thick_h(x) as a Predictor of thick_i(y)....
thick_ih_plot <- ggplot() +
  
  # plot the raw data as points
  geom_point(data = thickness_all,
             aes(x = thick_h,
                 y = thick_i),
             alpha = 0.5,
             color = model_col,
             shape = 21) +
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence interval 
  geom_ribbon(data = thick_ih_predictions,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2,
              fill = model_col) +
  
  # plot the prediction line
  geom_line(data = thick_ih_predictions,
            aes(x = x,
                y = predicted),
            color = model_col,
            linewidth = 1) +
  
  # labels
  labs(x = "Rehydrate thickness (mm)",
       y = "Initial thickness (mm)") +
  
  # controlling axes to make the plot look square
  # this makes it easier to see the difference between the model and the 1:1 line
  scale_x_continuous(breaks = seq(from = 0, to = 2, by = 0.25), 
                     limits = c(0, 2)) +
  scale_y_continuous(breaks = seq(from = 0, to = 2, by = 0.25), 
                     limits = c(0, 2))

thick_ih_plot

  #.Scatterplot of thick_h(x) as Predictor of thick_i(y) with a species facet.
thick_ih_plot_species <- ggplot() +
  
  geom_point(data = thickness_all,
             aes(x = thick_h,
                 y = thick_i,
                 color = species),
             alpha = 0.5,
             shape = 21) + 
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence intervals
  geom_ribbon(data = thick_ih_predictions_species,
            aes(x = x,
                y = predicted,
                ymin = conf.low,
                ymax = conf.high,
                fill = species,
                group = species),
            alpha = 0.2) +
  
  # plot the model predictions
  geom_line(data = thick_ih_predictions_species,
            aes(x = x,
                y = predicted,
                color = species,
                group = species)) +
  
  # labels
  labs(x = "Herbarium thickness (mm)",
       y = "Initial thickness (mm)") +
  
  # theme
  theme(legend.position = "none",
        strip.background = element_blank(),
        strip.text = element_text(size = 12)) +
  
  # facet
  facet_wrap(~ species, nrow = 2,
             scales = "free")


  thick_ih_plot_species

```

### Perimeter

```{r perimeter-herbarium - PLOT}

     #....Scatterplot of per_h(x) as a Predictor of per_i(y)....
perimeter_ih_plot <- ggplot() +
  
  # plot the raw data as points
  geom_point(data = perimeter_all,
             aes(x = per_h,
                 y = per_i),
             alpha = 0.5,
             color = model_col,
             shape = 21) +
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence interval 
  geom_ribbon(data = perimeter_ih_predictions,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2,
              fill = model_col) +
  
  # plot the prediction line
  geom_line(data = perimeter_ih_predictions,
            aes(x = x,
                y = predicted),
            color = model_col,
            linewidth = 1) +
  
  # labels
  labs(x = "Herbarium perimeter (mm)",
       y = "Initial perimeter (mm)") +
  
  # controlling axes to make the plot look square
  # this makes it easier to see the difference between the model and the 1:1 line
  scale_x_continuous(breaks = seq(from = 0, to = 375, by = 50), 
                     limits = c(0, 375)) +
  scale_y_continuous(breaks = seq(from = 0, to = 375, by = 50), 
                     limits = c(0, 375))
perimeter_ih_plot


  #.Scatterplot of per_h(x) as Predictor of per_i(y) with a species facet.
perimeter_ih_plot_species <- ggplot() +
  
  geom_point(data = perimeter_all,
             aes(x = per_h,
                 y = per_i,
                 color = species),
             alpha = 0.5,
             shape = 21) + 
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence intervals
  geom_ribbon(data = perimeter_ih_predictions_species,
            aes(x = x,
                y = predicted,
                ymin = conf.low,
                ymax = conf.high,
                fill = species,
                group = species),
            alpha = 0.2) +
  
  # plot the model predictions
  geom_line(data = perimeter_ih_predictions_species,
            aes(x = x,
                y = predicted,
                color = species,
                group = species)) +
  
  # labels
  labs(x = "Herbarium perimeter (mm)",
       y = "Initial perimeter (mm)") +
  
  # theme
  theme(legend.position = "none",
        strip.background = element_blank(),
        strip.text = element_text(size = 12)) +
  
  # facet
  facet_wrap(~ species, nrow = 2,
             scales = "free")


  perimeter_ih_plot_species
```

### Surface Area

```{r surf-herbarium - PLOT (species)}

     #....Scatterplot of surf_h(x) as a Predictor of surf_i(y)....
surf_ih_plot <- ggplot() +
  
  # plot the raw data as points
  geom_point(data = surf_all,
             aes(x = surf_h,
                 y = surf_i),
             alpha = 0.5,
             color = model_col,
             shape = 21) +
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence interval 
  geom_ribbon(data = surf_ih_predictions,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2,
              fill = model_col) +
  
  # plot the prediction line
  geom_line(data = surf_ih_predictions,
            aes(x = x,
                y = predicted),
            color = model_col,
            linewidth = 1) +
  
  # labels
  labs(x = "Herbarium Surface Area (mm^2)",
       y = "Initial Surface Area (mm^2)") +
  
  # controlling axes to make the plot look square
  # this makes it easier to see the difference between the model and the 1:1 line
  scale_x_continuous(breaks = seq(from = 0, to = 450, by = 75), 
                     limits = c(0, 450)) +
  scale_y_continuous(breaks = seq(from = 0, to = 450, by = 75), 
                     limits = c(0, 450))
surf_ih_plot

  #.Scatterplot of surf_h(x) as Predictor of surf_i(y) with a species facet.
surf_ih_plot_species <- ggplot() +
  
  geom_point(data = surf_all,
             aes(x = surf_r,
                 y = surf_i,
                 color = species),
             alpha = 0.5,
             shape = 21) + 
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence intervals
  geom_ribbon(data = surf_ih_predictions_species,
            aes(x = x,
                y = predicted,
                ymin = conf.low,
                ymax = conf.high,
                fill = species,
                group = species),
            alpha = 0.2) +
  
  # plot the model predictions
  geom_line(data = surf_ih_predictions_species,
            aes(x = x,
                y = predicted,
                color = species,
                group = species)) +
  
  # labels
  labs(x = "Herbarium Surface Area (mm^2)",
       y = "Initial Surface Area (mm^2)") +
  
  # theme
  theme(legend.position = "none",
        strip.background = element_blank(),
        strip.text = element_text(size = 12)) +
  
  # facet
  facet_wrap(~ species, nrow = 2,
             scales = "free")


  surf_ih_plot_species
```

### Weight

```{r tdmc-herbarium - plot - species}

     #....Scatterplot of weight_h(x) as a Predictor of weight_i(y)....
tdmc_ih_plot <- ggplot() +
  
  # plot the raw data as points
  geom_point(data = tdmc_all,
             aes(x = weight_h,
                 y = weight_i),
             alpha = 0.5,
             color = model_col,
             shape = 21) +
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence interval 
  geom_ribbon(data = tdmc_ih_predictions,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2,
              fill = model_col) +
  
  # plot the prediction line
  geom_line(data = tdmc_ih_predictions,
            aes(x = x,
                y = predicted),
            color = model_col,
            linewidth = 1) +
  
  # labels
  labs(x = "Herbarium weight (g)",
       y = "Initial weight (g)") +
  
  # controlling axes to make the plot look square
  # this makes it easier to see the difference between the model and the 1:1 line
  scale_x_continuous(breaks = seq(from = 0, to = 4850, by = 810), 
                     limits = c(0, 4850)) +
  scale_y_continuous(breaks = seq(from = 0, to = 4850, by = 810), 
                     limits = c(0, 4850))
tdmc_ih_plot


  #.Scatterplot of weight_h(x) as Predictor of weight_i(y) with a species facet.
tdmc_ih_plot_species <- ggplot() +
  
  geom_point(data = tdmc_all,
             aes(x = weight_h,
                 y = weight_i,
                 color = species),
             alpha = 0.5,
             shape = 21) + 
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence intervals
  geom_ribbon(data = tdmc_ih_predictions_species,
            aes(x = x,
                y = predicted,
                ymin = conf.low,
                ymax = conf.high,
                fill = species,
                group = species),
            alpha = 0.2) +
  
  # plot the model predictions
  geom_line(data = tdmc_ih_predictions_species,
            aes(x = x,
                y = predicted,
                color = species,
                group = species)) +
  
  # labels
  labs(x = "Herbarium weight (g)",
       y = "Initial weight (g)") +
  
  # theme
  theme(legend.position = "none",
        strip.background = element_blank(),
        strip.text = element_text(size = 12)) +
  
  # facet
  facet_wrap(~ species, nrow = 2,
             scales = "free")


 tdmc_ih_plot_species
```

### Volume

```{r volume-herbarium - PLOT}

     #....Scatterplot of vol_h(x) as a Predictor of vol_i(y)....
volume_ih_plot <- ggplot() +
  
  # plot the raw data as points
  geom_point(data = volume_all,
             aes(x = vol_h,
                 y = vol_i),
             alpha = 0.5,
             color = model_col,
             shape = 21) +
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence interval 
  geom_ribbon(data = volume_ih_predictions,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2,
              fill = model_col) +
  
  # plot the prediction line
  geom_line(data = volume_ih_predictions,
            aes(x = x,
                y = predicted),
            color = model_col,
            linewidth = 1) +
  
  # labels
  labs(x = "Herbarium volume (mL)",
       y = "Initial volume (mL)") +
  
  # controlling axes to make the plot look square
  # this makes it easier to see the difference between the model and the 1:1 line
  scale_x_continuous(breaks = seq(from = 0, to = 15, by = 2.5), 
                     limits = c(0, 15)) +
  scale_y_continuous(breaks = seq(from = 0, to = 15, by = 2.5), 
                     limits = c(0, 15))
volume_ih_plot


  #.Scatterplot of vol_h(x) as Predictor of vol_i(y) with a species facet.
volume_ih_plot_species <- ggplot() +
  
  geom_point(data = volume_all,
             aes(x = vol_h,
                 y = vol_i,
                 color = species),
             alpha = 0.5,
             shape = 21) + 
  
  # plot a 1:1 reference line
  geom_abline(slope = 1, 
              intercept = 0,
              linetype = 2,
              linewidth = 1,
              color = ref_line_col) +
  
  # plot the confidence intervals
  geom_ribbon(data = volume_ih_predictions_species,
            aes(x = x,
                y = predicted,
                ymin = conf.low,
                ymax = conf.high,
                fill = species,
                group = species),
            alpha = 0.2) +
  
  # plot the model predictions
  geom_line(data = volume_ih_predictions_species,
            aes(x = x,
                y = predicted,
                color = species,
                group = species)) +
  
  # labels
  labs(x = "Herbarium volume (mL)",
       y = "Initial volume (mL)") +
  
  # theme
  theme(legend.position = "none",
        strip.background = element_blank(),
        strip.text = element_text(size = 12)) +
  
  # facet
  facet_wrap(~ species, nrow = 2,
             scales = "free")


  volume_ih_plot_species

```

## c. Visualizing summary graphs for rehydrate models
This section includes visualizations that plot multiple trait models on a single graph

### Scatterplot faceted by trait

This scatterplot visualizes predictions for height, width, perimeter, weight, surface area, thickness, and volume as a function of inital trait values, faceted by trait. 

```{r fig.width = 20, fig.height = 10}
# surf_ir_predictions, perimeter_ir_predictions, tdmc_ir_predictions, height_ir_predictions, width_ir_predictions, thick_ir_predictions, volume_ir_predictions



     #.........................Data Wrangling.........................

#creating a list of all the predictions for rehydrate traits
init_rehy_df <- rbind(surf_ir_predictions, # rbind stacks data frames on top of each other if they have the same columns
                      perimeter_ir_predictions, 
                      tdmc_ir_predictions, 
                      height_ir_predictions, 
                      width_ir_predictions, 
                      thick_ir_predictions, 
                      volume_ir_predictions) |> 
  drop_na() # not sure why there are NA rows at the end of the data frame, but they come from one of the prediction data frames


     #.........A scatterplot with all seven model predictions.........
ggplot(data = init_rehy_df, # using the data frame created above
       aes(x = x, # x-axis
           y = predicted )) + # y-axis
  geom_abline(slope = 1, # adding a dashed grey 1:1 reference line
              intercept = 0,
              color = "grey",
              linetype = 2) + 
  # geom_ribbon(aes(fill = trait, # adding 95% CI 
  #                 ymin = conf.low,
  #                 ymax = conf.high),
  #             alpha = 0.2) +
  geom_line(aes(color = trait), 
            linewidth = 1) + # plotting model predictions
  labs(x = "Rehydrated value", # renaming the axes
       y = "Initial value") +
  theme(legend.position = "none") +
  facet_wrap(~trait, scales = "free")



```


### Highlighting 1:1 relationships

This scatterplot visualizes predictions for height, width, perimeter, surface area, thickness, and volume as a function of inital trait values. Prediction lines are on the same graph, and models that follow a 1:1 relationship are highlighted. 

```{r}
     #..............................Setup.............................

#Using the dataframe with all our rehydrate trait predictions to assign an opacity
#value to all traits. 3 signifies a close 1:1 relationship while 0.1 is a weak 1:1.
init <- init_rehy_df 
init23 <- init[init$trait != "thallus dry matter content"]
init23$opacity <- ifelse(init23$trait == "height", 3,
                      ifelse(init23$trait == "width", 3,
                             ifelse(init23$trait == "perimeter", 0.1, 
                                    ifelse(init23$trait == "surface area", 0.1, 
                                                  ifelse(init23$trait == "thickness", 0.1, 
                                                         ifelse(init23$trait == "volume", 0.1, NA ))))))
     #........manually offsetting height and width line labels........
label_df <- init23 |> 
  filter(x == max(x)) |> 
  mutate(label = stringr::str_to_title(trait),
         nudge_y = case_when(
           trait == "height" ~ 0.7,
           trait == "width" ~ -0.3,
           TRUE ~ 0
         ))

     #........................generating titles.......................
title <- "Two predictive trait models based on rehydrated values closely follow a 1:1 relationship"
subtitle <- "The traits that follow this pattern are Height and Width"

     #..............assigning each trait a unique color...............
showtext_auto()
trait_palette <- c("surface area" = "#ffbf00", 
                   "perimeter" = "#be8333", 
                  # "thallus dry matter content" = "#54662c", 
                   "height" = "#009bb0", 
                   "width" = "#124c54", 
                   "thickness" = "#368000", 
                   "volume" = "#b4450e")

     #........scatterplot with all rehydrate trait predictions........
     #......rehydrated trait value (x) & initial trait values (y).....
     #..excludes tdmc, and highlights traits with 1:1 relationships...
 plot_ir_1s <- init23 |> 
  ggplot(aes(x, predicted, color = trait, alpha = opacity))+
  geom_line()+
  geom_abline(slope = 1, # adding a dashed grey 1:1 reference line
              intercept = 0,
              color = "grey",
              linetype = 2) + 
  # geom_ribbon(aes(fill = trait, # adding 95% CI (uncomment this if you want to see it)
  #                 ymin = conf.low,
  #                 ymax = conf.high),
  #             alpha = 0.2) +
  geom_line(
            linewidth = 0.5) + # plotting model predictions
  labs(x = "Rehydrated Value", # renaming the axes
       y = "Predicted Initial Value", 
       title = title,
       subtitle = subtitle) +
  scale_color_manual(values = trait_palette)+ #assigning values a color based on trait from our palette
  theme(legend.position = "none", 
        plot.background = element_blank())+
 #formatting line labels
    geom_text(
    data = init23 |> filter(x == max(x)) |> mutate(label = stringr::str_to_title(trait)),
    aes(label = label, alpha = opacity), 
    hjust = 0, 
    nudge_x = 0.1,
    nudge_y = label_df$nudge_y,
    size = 5, 
    family = "lex", 
    #alpha = opacity
    #fontface = "light"
  )+
   #formatting text and margins
  coord_cartesian(xlim = c(0, 7.2), 
                  clip = "off")+
  theme(plot.margin = margin(t = 1, r = 1, b = 1, l = 1, "cm"))+
   theme(axis.title.x = element_text(family = "lex",
                                 size = 14,
                                 hjust = 0.5,
                                 margin = margin(t = 0, r = 0, b = 0.5, l = 0, "cm")),
         axis.title.y = element_text(family = "lex",
                                 size = 14,
                                 hjust = 0.5,
                                 margin = margin(t = 0, r = 0, b = 0.5, l = 0, "cm")), 
          plot.title = element_text(family = "lex", 
                              size = 17, 
                              hjust = 0.5,
                              margin = margin(t = 0, r = 1, b = 0.3, l = 0, "cm")),
    plot.subtitle = element_text(family = "lex",
                                 size = 15,
                                 hjust = 0.5,
                                 margin = margin(t = 0, r = 0, b = 0.5, l = 0, "cm")))+
  scale_x_continuous(expand = c(0, NA))+
  scale_y_continuous(limits = c(0.8,NA))
 
 plot_ir_1s

```

### Highlighting relationships that deviate from 1:1

This includes code for a scatterplot of height, width, perimeter, surface area, thickness, and volume on the same graph. Models that deviate from a 1:1 relationship are highlighted.

```{r fig.width = 10, fig.height = 10}

#.........................assigning opacity values (manually).........................

#traits that follow a 1:1 relationship are assigned 1, while deviants from 1:1
#are assigned 3. 
showtext_auto()
init <- init_rehy_df 
init2 <- as.data.frame(init) |> 
  mutate(trait = as.factor(trait))

init2 <- init[init$trait != "thallus dry matter content"]
init2$opacity <- ifelse(init2$trait == "height", 1,
                      ifelse(init2$trait == "width", 1,
                             ifelse(init2$trait == "perimeter", 3, 
                                    ifelse(init2$trait == "surface area", 3, 
                                                  ifelse(init2$trait == "thickness", 1, 
                                                         ifelse(init2$trait == "volume", 3, NA ))))))

#.........................titles and palettes.........................

title <- "Predictive models based on rehydrated measurements vary by trait"
subtitle <- "The traits that deviate the most are Perimeter, Volume, and Surface Area"

showtext_auto()
trait_palette <- c("surface area" = "#ffbf00", 
                   "perimeter" = "#be8333", 
                  # "thallus dry matter content" = "#54662c", 
                   "height" = "#009bb0", 
                   "width" = "#124c54", 
                   "thickness" = "#368000", 
                   "volume" = "#b4450e")

#.........................plotting.........................
#......rehydrate trait values (x) & initial trait values (y).....

plot_ir_deviants <- init2 |> 
  ggplot(aes(x, predicted, color = trait, alpha = opacity))+
  geom_line()+
  geom_abline(slope = 1, # adding a dashed grey 1:1 reference line
              intercept = 0,
              color = "grey",
              linetype = 2) + 
  # geom_ribbon(aes(fill = trait, # adding 95% CI (uncomment this if you want to see it)
  #                 ymin = conf.low,
  #                 ymax = conf.high),
  #             alpha = 0.2) +
  geom_line(
            linewidth = 1.5) + # plotting model predictions
  labs(x = "Rehydrated Value", # renaming the axes
       y = "Predicted Initial Value", 
       title = title,
       subtitle = subtitle) +
  scale_color_manual(values = trait_palette)+ #assigning palette colors to traits
  theme(legend.position = "none", 
        plot.background = element_blank())+
  geom_text( #formatting model labels
    data = init2 |> filter(x == max(x)) |> mutate(label = stringr::str_to_title(trait)),
    aes(label = label), 
    hjust = 0, 
    nudge_x = 0.1, 
    size = 5, 
    family = "lex"
    #fontface = "light"
  )+
  #manually adjusting text elements and plot dimensions
  coord_cartesian(xlim = c(0, 7.2), 
                  clip = "off")+
  theme(plot.margin = margin(t = 1, r = 1, b = 1, l = 1, "cm"))+
   theme(axis.title.x = element_text(family = "lex",
                                 size = 14,
                                 hjust = 0.5,
                                 margin = margin(t = 0, r = 0, b = 0.5, l = 0, "cm")),
         axis.title.y = element_text(family = "lex",
                                 size = 14,
                                 hjust = 0.5,
                                 margin = margin(t = 0, r = 0, b = 0.5, l = 0, "cm")), 
          plot.title = element_text(family = "lex", 
                              size = 17, 
                              hjust = 0.5,
                              margin = margin(t = 0, r = 0, b = 0.3, l = 0, "cm")),
    plot.subtitle = element_text(family = "lex",
                                 size = 15,
                                 hjust = 0.5,
                                 margin = margin(t = 0, r = 0, b = 0.5, l = 0, "cm")))+
  scale_x_continuous(expand = c(0, NA))+
  scale_y_continuous(limits = c(0.8,NA))

plot_ir_deviants
```
